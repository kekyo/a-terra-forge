// a-terra-gorge - Universal document-oriented markdown site generator
// Copyright (c) Kouji Matsui. (@kekyo@mi.kekyo.net)
// Under MIT.
// https://github.com/kekyo/a-terra-gorge

import { mkdir, readFile, writeFile } from 'fs/promises';
import { dirname, resolve } from 'path';

const rootDir = process.cwd();
const sourcePath = resolve(
  rootDir,
  'node_modules',
  'bootstrap-icons',
  'font',
  'bootstrap-icons.json'
);
const outputPath = resolve(rootDir, 'src', 'generated', 'bootstrapIcons.ts');

const raw = await readFile(sourcePath, 'utf8');
const parsed = JSON.parse(raw);
if (!parsed || typeof parsed !== 'object' || Array.isArray(parsed)) {
  throw new Error('bootstrap-icons.json must be an object.');
}

const toHexString = (code) => {
  if (typeof code === 'number' && Number.isFinite(code)) {
    return code.toString(16);
  }
  if (typeof code === 'string' && code.length > 0) {
    return code;
  }
  return null;
};

const entries = Object.entries(parsed)
  .map(([name, code]) => [name, toHexString(code)])
  .filter(
    ([name, code]) =>
      typeof name === 'string' && typeof code === 'string' && code.length > 0
  )
  .sort(([a], [b]) => a.localeCompare(b));

const lines = [
  '// @ts-nocheck',
  '// This file is auto-generated by scripts/generate-bootstrap-icons.js',
  '// Do not edit manually',
  '',
  'export const bootstrapIcons = {',
  ...entries.map(([name, code]) => `  "${name}": "${code.toLowerCase()}",`),
  '} as const;',
  '',
  'export type BootstrapIconName = keyof typeof bootstrapIcons;',
  '',
];

await mkdir(dirname(outputPath), { recursive: true });
await writeFile(outputPath, lines.join('\n'), 'utf8');
